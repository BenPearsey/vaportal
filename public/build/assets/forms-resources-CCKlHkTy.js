import{K as Te,r,j as e,L as Se,R as Ae,S as u,t as Ue}from"./app-DUSEAaDk.js";import{A as Le}from"./app-layout-admin-bPDzceOK.js";import{C as Oe,a as Re,b as ze,c as Pe}from"./card-DLziDOQe.js";import{T as Me,a as $e,b as q}from"./tabs-CdeGy1fN.js";import{I as j}from"./index-CsbLVuVn.js";import{B as a}from"./app-logo-icon-niQwcySJ.js";import{T as Be,a as Ee,b as k,c as o,d as He,e as i}from"./table-DFxtelq1.js";import{D as b,a as C,b as v,c as N}from"./dialog-h4m6KRJP.js";import{F as D}from"./use-mobile-navigation-xAdiOegP.js";import{U as P}from"./user-C2oc2Una.js";import{M as ce}from"./move-right-Ebc8C-Mb.js";import{T as ue}from"./trash-2-D2cVRMBt.js";import{F as Ie}from"./file-text-Lb0kZEB0.js";import{E as Je}from"./eye-Dzot2m_d.js";import{D as Ge}from"./download-CYFmTqDM.js";import{P as Ke}from"./pencil-D_Mfv_xm.js";import"./sonner-BAI07Ub3.js";import"./briefcase-business-D4N79Uzy.js";import"./users-Dz1g4iLP.js";import"./user-plus-BCs7l9Mm.js";import"./index-DDuQ3gsv.js";const y=f=>f==null?"":String(f),Ve=f=>f===0?"general":f===1?"agents":"clients";function ps(){const{folders:f,documents:Q}=Te().props,[M,he]=r.useState("general"),t=M==="general"?0:M==="agents"?1:2,g={id:0,name:t===0?"Root":t===1?"Agents":"Clients",parent_id:null,bucket:t,published_for_agents:!1,published_for_clients:!1},$=f.filter(s=>s.bucket===t),W=t===0?Q:Q.filter(s=>t===1?s.published_for_agents:s.published_for_clients),[T,X]=r.useState([g]),c=T[T.length-1],me=$.filter(s=>c.id===g.id?s.parent_id==null:s.parent_id===c.id),xe=c.id===g.id&&t!==0?W:W.filter(s=>c.id===g.id?s.folder_id==null:s.folder_id===c.id),[B,pe]=r.useState(""),[n,F]=r.useState({name:"",type:"All",agents:"All",clients:"All",uploader:""}),je=s=>!(n.name&&!s.name.toLowerCase().includes(n.name.toLowerCase())||n.type!=="All"&&n.type!=="Folder"||n.agents!=="All"&&(s.published_for_agents?"Published":"Unpublished")!==n.agents||n.clients!=="All"&&(s.published_for_clients?"Published":"Unpublished")!==n.clients),fe=s=>{var l;return!(n.name&&!(s.title??"").toLowerCase().includes(n.name.toLowerCase())||n.type!=="All"&&n.type!=="File"||n.agents!=="All"&&(s.published_for_agents?"Published":"Unpublished")!==n.agents||n.clients!=="All"&&(s.published_for_clients?"Published":"Unpublished")!==n.clients||n.uploader&&((l=s.uploader)!=null&&l.admin)&&!`${s.uploader.admin.firstname} ${s.uploader.admin.lastname}`.toLowerCase().includes(n.uploader.toLowerCase()))},Z=me.filter(s=>s.name.toLowerCase().includes(B.toLowerCase())).filter(je),ee=xe.filter(s=>(s.title??"").toLowerCase().includes(B.toLowerCase())).filter(fe),[m,S]=r.useState(null),[x,A]=r.useState(null),[U,L]=r.useState(null),[E,O]=r.useState(null),[p,w]=r.useState(null),[ge,H]=r.useState(!1),[I,se]=r.useState(""),[be,R]=r.useState(!1),[le,Ce]=r.useState(null),[J,ne]=r.useState(""),[G,ve]=r.useState(!1),[K,Ne]=r.useState(!1),[_e,z]=r.useState(!1),h=s=>({onSuccess:()=>{Ue.success(s),u.reload({only:["folders","documents"]})}}),Fe=(s,l)=>u.post(route("admin.resources.folders.rename",s),{name:l},h("Folder renamed")),we=(s,l)=>u.post(route("admin.resources.documents.rename",s),{title:l},h("Document renamed")),V=(s,l)=>u.post(route("admin.resources.folders.move",s),{parent_id:y(l)},h("Folder moved")),Y=(s,l)=>u.post(route("admin.resources.documents.move",s),{folder_id:y(l)},h("Document moved")),te=(s,l,d)=>u.patch(route("admin.resources.documents.toggle",s),{column:l,value:d},h("Publish toggled")),ke=s=>u.delete(route("admin.resources.folders.destroy",s),h("Folder deleted")),De=(s,l)=>u.delete(route("admin.resources.documents.destroy",s),{data:{scope:l}},h("Document deleted")),ae=(s,l,d)=>{s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("application/json",JSON.stringify({kind:d,id:l}))},re=(s,l)=>{var de;s.preventDefault();const d=(de=s.dataTransfer.files)==null?void 0:de[0];if(d){const _=new FormData;_.append("file",d),_.append("title",J||d.name),_.append("folder_id",y(l)),_.append("published_for_agents",t===1||t===0&&G?"1":"0"),_.append("published_for_clients",t===2||t===0&&K?"1":"0"),z(!0),u.post(route("admin.resources.documents.store"),_,{...h("Uploaded"),onFinish:()=>{z(!1),R(!1)}});return}const ie=s.dataTransfer.getData("application/json");if(!ie)return;const{kind:ye,id:oe}=JSON.parse(ie);ye==="folder"?V(oe,l):Y(oe,l)};return e.jsxs(Le,{children:[e.jsx(Se,{title:"Forms & Resources"}),e.jsx(Me,{value:M,onValueChange:s=>he(s),className:"mb-4",children:e.jsxs($e,{children:[e.jsx(q,{value:"general",children:"General"}),e.jsx(q,{value:"agents",children:"Agents"}),e.jsx(q,{value:"clients",children:"Clients"})]})}),e.jsxs(Oe,{className:"h-full flex flex-col",children:[e.jsxs(Re,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ze,{children:"Forms & Resources"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:T.map((s,l)=>e.jsxs(Ae.Fragment,{children:[l>0&&e.jsx("span",{children:" / "}),e.jsx("span",{className:"font-medium",children:s.name})]},s.id))})]}),T.length>1&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>X(s=>s.slice(0,-1)),children:"Back"})]}),e.jsxs(Pe,{className:"p-4 flex-1 overflow-auto",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4 items-center",children:[e.jsx(j,{placeholder:"Filter by name…",value:B,onChange:s=>pe(s.currentTarget.value),className:"flex-1 max-w-sm"}),e.jsx(a,{onClick:()=>H(!0),children:"New Folder"}),e.jsx(a,{onClick:()=>R(!0),children:_e?"Uploading…":"Upload"})]}),e.jsxs(Be,{children:[e.jsxs(Ee,{children:[e.jsxs(k,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Type"}),e.jsx(o,{className:"text-center",children:"Agents"}),e.jsx(o,{className:"text-center",children:"Clients"}),e.jsx(o,{children:"Uploaded By"}),e.jsx(o,{children:"Uploaded At"}),e.jsx(o,{className:"text-right",children:"Actions"})]}),e.jsxs(k,{children:[e.jsx(o,{children:e.jsx(j,{placeholder:"Filter Name",value:n.name,onChange:s=>F(l=>({...l,name:s.target.value})),size:"sm"})}),e.jsx(o,{children:e.jsxs("select",{className:"w-full h-8 rounded border px-2",value:n.type,onChange:s=>F(l=>({...l,type:s.target.value})),children:[e.jsx("option",{children:"All"}),e.jsx("option",{children:"Folder"}),e.jsx("option",{children:"File"})]})}),e.jsx(o,{className:"text-center",children:e.jsxs("select",{className:"w-full h-8 rounded border px-2",value:n.agents,onChange:s=>F(l=>({...l,agents:s.target.value})),children:[e.jsx("option",{children:"All"}),e.jsx("option",{children:"Published"}),e.jsx("option",{children:"Unpublished"})]})}),e.jsx(o,{className:"text-center",children:e.jsxs("select",{className:"w-full h-8 rounded border px-2",value:n.clients,onChange:s=>F(l=>({...l,clients:s.target.value})),children:[e.jsx("option",{children:"All"}),e.jsx("option",{children:"Published"}),e.jsx("option",{children:"Unpublished"})]})}),e.jsx(o,{children:e.jsx(j,{placeholder:"Filter Uploader",value:n.uploader,onChange:s=>F(l=>({...l,uploader:s.target.value})),size:"sm"})}),e.jsx(o,{})," ",e.jsx(o,{})," "]})]}),e.jsxs(He,{children:[Z.map(s=>e.jsxs(k,{className:"cursor-pointer hover:bg-muted",onClick:()=>X(l=>[...l,s]),onContextMenu:l=>{l.preventDefault(),S({id:s.id,name:s.name})},draggable:!0,onDragStart:l=>ae(l,s.id,"folder"),onDragOver:l=>l.preventDefault(),onDrop:l=>re(l,s.id),children:[e.jsxs(i,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:s.name})]}),e.jsx(i,{children:"Folder"}),e.jsx(i,{className:"text-center",children:e.jsx(P,{size:16,className:s.published_for_agents?"text-blue-600":"text-gray-400"})}),e.jsx(i,{className:"text-center",children:e.jsx(P,{size:16,className:s.published_for_clients?"text-blue-600":"text-gray-400"})}),e.jsx(i,{children:"—"}),e.jsx(i,{children:"—"}),e.jsxs(i,{className:"flex justify-end space-x-2",children:[e.jsx(a,{variant:"ghost",size:"icon",onClick:l=>{l.stopPropagation(),L(s.id)},children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>w({kind:"folder",id:s.id}),children:e.jsx(ue,{className:"w-4 h-4 text-red-600"})})]})]},`folder-${s.id}`)),ee.map(s=>{var l;return e.jsxs(k,{draggable:!0,onDragStart:d=>ae(d,s.id,"doc"),children:[e.jsxs(i,{className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:s.title})]}),e.jsx(i,{children:"File"}),e.jsx(i,{className:"text-center",children:e.jsx(P,{size:16,className:s.published_for_agents?"text-blue-600":"text-gray-400",onClick:()=>te(s.id,"published_for_agents",!s.published_for_agents)})}),e.jsx(i,{className:"text-center",children:e.jsx(P,{size:16,className:s.published_for_clients?"text-blue-600":"text-gray-400",onClick:()=>te(s.id,"published_for_clients",!s.published_for_clients)})}),e.jsx(i,{children:(l=s.uploader)!=null&&l.admin?`${s.uploader.admin.firstname} ${s.uploader.admin.lastname}`:"—"}),e.jsx(i,{children:new Date(s.created_at).toLocaleString()}),e.jsxs(i,{className:"flex justify-end space-x-2",children:[e.jsx("a",{href:route("admin.forms-resources.show",s.id),target:"_blank",rel:"noopener noreferrer",children:e.jsx(a,{variant:"ghost",size:"icon",children:e.jsx(Je,{className:"w-4 h-4"})})}),e.jsx(a,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx("a",{href:route("admin.forms-resources.show",s.id),download:!0,children:e.jsx(Ge,{className:"w-4 h-4"})})}),e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>A({id:s.id,title:s.title||""}),children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>O(s.id),children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>w({kind:"doc",id:s.id}),children:e.jsx(ue,{className:"w-4 h-4 text-red-600"})})]})]},`doc-${s.id}`)}),Z.length===0&&ee.length===0&&e.jsx(k,{children:e.jsx(i,{colSpan:7,className:"text-center text-gray-500",children:"Nothing here."})})]})]}),e.jsxs("div",{className:"border-2 border-dashed rounded p-6 text-center text-muted-foreground mt-8",onDragOver:s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},onDrop:s=>re(s,c.id===g.id?null:c.id),children:["Drag & Drop files here to upload into ",e.jsx("strong",{children:c.name})]})]})]}),e.jsx(b,{open:ge,onOpenChange:H,children:e.jsxs(C,{children:[e.jsx(v,{children:e.jsx(N,{children:"Create Folder"})}),e.jsx(j,{placeholder:"Folder name",value:I,onChange:s=>se(s.target.value)}),e.jsx(a,{className:"mt-4",disabled:!I.trim(),onClick:()=>{u.post(route("admin.resources.folders.store"),{name:I.trim(),bucket:t,parent_id:y(c.id===g.id?null:c.id)},h("Folder created")),se(""),H(!1)},children:"Create"})]})}),e.jsx(b,{open:be,onOpenChange:R,children:e.jsxs(C,{children:[e.jsx(v,{children:e.jsx(N,{children:"Upload"})}),e.jsx(j,{type:"file",onChange:s=>{var d;const l=(d=s.target.files)==null?void 0:d[0];l&&(Ce(l),ne(l.name))}}),e.jsx(j,{className:"mt-2",placeholder:"Title",value:J,onChange:s=>ne(s.target.value)}),t===0&&e.jsxs("div",{className:"flex gap-8 mt-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:G,onChange:s=>ve(s.target.checked)})," ","Agents"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:K,onChange:s=>Ne(s.target.checked)})," ","Clients"]})]}),e.jsx(a,{className:"mt-4",disabled:!le,onClick:()=>{const s=new FormData;s.append("file",le),s.append("title",J),s.append("folder_id",y(c.id===g.id?null:c.id)),s.append("published_for_agents",t===1||t===0&&G?"1":"0"),s.append("published_for_clients",t===2||t===0&&K?"1":"0"),z(!0),u.post(route("admin.resources.documents.store"),s,{...h("Uploaded"),onFinish:()=>{z(!1),R(!1)}})},children:"Upload"})]})}),e.jsx(b,{open:!!m,onOpenChange:()=>S(null),children:e.jsxs(C,{children:[e.jsx(v,{children:e.jsx(N,{children:"Rename Folder"})}),e.jsx(j,{value:(m==null?void 0:m.name)||"",onChange:s=>S(m?{...m,name:s.target.value}:null)}),e.jsx(a,{className:"mt-4",onClick:()=>{m&&Fe(m.id,m.name),S(null)},children:"Save"})]})}),e.jsx(b,{open:!!x,onOpenChange:()=>A(null),children:e.jsxs(C,{children:[e.jsx(v,{children:e.jsx(N,{children:"Rename Document"})}),e.jsx(j,{value:(x==null?void 0:x.title)||"",onChange:s=>A(x?{...x,title:s.target.value}:null)}),e.jsx(a,{className:"mt-4",onClick:()=>{x&&we(x.id,x.title),A(null)},children:"Save"})]})}),e.jsx(b,{open:U!=null,onOpenChange:()=>L(null),children:e.jsxs(C,{children:[e.jsx(v,{children:e.jsx(N,{children:"Move Folder"})}),e.jsxs(a,{variant:"outline",onClick:()=>{V(U,null),L(null)},children:[e.jsx(D,{className:"w-4 h-4 mr-2"})," Root"]}),$.filter(s=>s.id!==U).map(s=>e.jsxs(a,{variant:"outline",className:"mt-2",onClick:()=>{V(U,s.id),L(null)},children:[e.jsx(D,{className:"w-4 h-4 mr-2"})," ",s.name]},s.id))]})}),e.jsx(b,{open:E!=null,onOpenChange:()=>O(null),children:e.jsxs(C,{children:[e.jsx(v,{children:e.jsx(N,{children:"Move Document"})}),e.jsxs(a,{variant:"outline",onClick:()=>{Y(E,null),O(null)},children:[e.jsx(D,{className:"w-4 h-4 mr-2"})," Root"]}),$.map(s=>e.jsxs(a,{variant:"outline",className:"mt-2",onClick:()=>{Y(E,s.id),O(null)},children:[e.jsx(D,{className:"w-4 h-4 mr-2"})," ",s.name]},s.id))]})}),e.jsx(b,{open:!!p,onOpenChange:()=>w(null),children:e.jsxs(C,{children:[e.jsx(v,{children:e.jsx(N,{children:t===0||(p==null?void 0:p.kind)==="folder"?"Delete permanently?":"Un-publish?"})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(a,{variant:"destructive",onClick:()=>{p&&(p.kind==="folder"?ke(p.id):De(p.id,t===0?"general":Ve(t)),w(null))},children:"Yes"}),e.jsx(a,{onClick:()=>w(null),children:"Cancel"})]})]})})]})}export{ps as default};
