import{K as F,r as o,j as e,L as V,$ as J,S as R,m as H,t as c,a as I}from"./app-DUSEAaDk.js";import{A as L}from"./app-layout-admin-bPDzceOK.js";import{C as B,a as P,b as $,c as K}from"./card-DLziDOQe.js";import{B as u}from"./app-logo-icon-niQwcySJ.js";import{I as w}from"./index-CsbLVuVn.js";import{T as W,a as _,b as E,c as g,d as q,e as b}from"./table-DFxtelq1.js";import{D as z,a as G,b as Q,c as X}from"./dialog-h4m6KRJP.js";import{d as l,S as O}from"./SlateEditor-DwhKE_qS.js";import{P as Y}from"./pencil-D_Mfv_xm.js";import{T as Z}from"./trash-2-D2cVRMBt.js";import"./use-mobile-navigation-xAdiOegP.js";import"./index-DDuQ3gsv.js";import"./sonner-BAI07Ub3.js";import"./briefcase-business-D4N79Uzy.js";import"./users-Dz1g4iLP.js";import"./user-plus-BCs7l9Mm.js";import"./index.es-CrC4eOKT.js";function ee({announcement:s,isOpen:N,onClose:d,onUpdated:x}){const m={title:s.title,type:s.type,content:s.content,description:s.description||""},{data:a,setData:n,put:v,processing:h,errors:r,reset:M}=H(m),[f,C]=o.useState(null),[D,A]=o.useState(()=>{if(s.type==="text")try{return JSON.parse(s.content)}catch{return l}return l}),j=o.useRef(D),[T,S]=o.useState(()=>{if(s.type!=="text"&&s.description)try{return JSON.parse(s.description)}catch{return l}return l}),y=o.useRef(T);o.useEffect(()=>{if(n("title",s.title),n("type",s.type),n("content",s.content),n("description",s.description||""),s.type==="text")try{const t=JSON.parse(s.content);A(t),j.current=t}catch{A(l),j.current=l}else if(s.description)try{const t=JSON.parse(s.description);S(t),y.current=t}catch{S(l),y.current=l}C(null)},[s,n]);const U=async t=>{c.loading("Uploading file...");const i=new FormData;i.append("file",t);try{const p=await I.post(route("announcements.upload"),i,{headers:{"Content-Type":"multipart/form-data"}});return c.success("Upload successful"),p.data.url}catch(p){throw console.error("File upload error:",p),c.error("File upload failed"),p}},k=async t=>{t.preventDefault();const i=c.loading("Updating announcement...");try{a.type==="text"?a.content=JSON.stringify(j.current):(a.type==="image"||a.type==="video")&&(f&&(a.content=await U(f)),a.description=JSON.stringify(y.current)),v(route("announcements.update",s.id),{onSuccess:()=>{c.success("Announcement updated successfully!",{id:i}),x(),d(),M()},onError:()=>{c.error("Announcement update failed!",{id:i})}})}catch(p){console.error("Update error:",p),c.error("Announcement update failed!",{id:i})}};return e.jsx(z,{open:N,onOpenChange:t=>{t||d()},children:e.jsxs(G,{className:"max-w-2xl",children:[e.jsx(Q,{children:e.jsx(X,{children:"Edit Announcement"})}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-title",className:"block text-sm font-medium",children:"Title"}),e.jsx(w,{id:"edit-title",type:"text",value:a.title,onChange:t=>n("title",t.target.value),placeholder:"Enter announcement title"}),r.title&&e.jsx("span",{className:"text-red-500 text-sm",children:r.title})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-type",className:"block text-sm font-medium",children:"Type"}),e.jsxs("select",{id:"edit-type",value:a.type,onChange:t=>{n("type",t.target.value),n("content",""),n("description",""),C(null)},className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"image",children:"Image"}),e.jsx("option",{value:"video",children:"Video"})]}),r.type&&e.jsx("span",{className:"text-red-500 text-sm",children:r.type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Content"}),a.type==="text"?e.jsx(O,{value:D,onChange:t=>{const i=t||l;A(i),j.current=i},placeholder:"Write your announcement..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(w,{type:"file",accept:a.type==="image"?"image/*":"video/*",onChange:t=>{t.target.files&&t.target.files[0]&&C(t.target.files[0])}}),f&&e.jsxs("p",{className:"text-sm",children:["Selected file: ",f.name]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium",children:"Caption / Description"}),e.jsx(O,{value:T,onChange:t=>{const i=t||l;S(i),y.current=i},placeholder:"Enter caption or description for the media..."})]})]}),r.content&&e.jsx("span",{className:"text-red-500 text-sm",children:r.content}),r.description&&e.jsx("span",{className:"text-red-500 text-sm",children:r.description})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),e.jsx(u,{type:"submit",disabled:h,children:h?"Updating...":"Update Announcement"})]})]})]})})}function ye(){const{announcements:s=[]}=F().props,[N,d]=o.useState(!1),[x,m]=o.useState(null),a=r=>{m(r),d(!0)},n=()=>{d(!1),m(null)},v=r=>{confirm("Are you sure you want to delete this announcement?")&&R.delete(route("announcements.destroy",r),{onSuccess:()=>{console.log("Deleted successfully")}})},h=()=>{};return e.jsxs(L,{breadcrumbs:[{title:"Manage Announcements",href:"/admin/announcement"}],children:[e.jsx(V,{title:"Manage Announcements"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold",children:"Manage Announcements"})}),e.jsx("div",{children:e.jsx(J,{href:route("announcements.create"),children:e.jsx(u,{variant:"default",children:"Add New Announcement"})})})]}),e.jsxs(B,{children:[e.jsx(P,{children:e.jsx($,{children:"Announcements"})}),e.jsx(K,{children:e.jsxs(W,{children:[e.jsx(_,{children:e.jsxs(E,{children:[e.jsx(g,{children:"Title"}),e.jsx(g,{children:"Type"}),e.jsx(g,{children:"Created At"}),e.jsx(g,{className:"text-right",children:"Actions"})]})}),e.jsx(q,{children:s.map(r=>e.jsxs(E,{children:[e.jsx(b,{children:r.title}),e.jsx(b,{children:r.type}),e.jsx(b,{children:new Date(r.created_at).toLocaleDateString()}),e.jsxs(b,{className:"text-right space-x-2",children:[e.jsx(u,{variant:"ghost",onClick:()=>a(r),children:e.jsx(Y,{className:"h-5 w-5 text-gray-500"})}),e.jsx(u,{variant:"ghost",onClick:()=>v(r.id),children:e.jsx(Z,{className:"h-5 w-5 text-gray-500"})})]})]},r.id))})]})})]})]}),x&&e.jsx(ee,{announcement:x,isOpen:N,onClose:n,onUpdated:h})]})}export{ye as default};
