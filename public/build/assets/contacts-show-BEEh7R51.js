import{K as X,r as d,m as G,j as e,L as J,$ as B,S as n,t as h}from"./app-DUSEAaDk.js";import{B as W,d as o}from"./badge-Dp8nKuAQ.js";import{E as Z,r as ee}from"./EventViewer-D5uvhi8T.js";import{A as se}from"./app-layout-admin-bPDzceOK.js";import{C as te,a as ae,b as ne}from"./card-DLziDOQe.js";import{B as a}from"./app-logo-icon-niQwcySJ.js";import{D as j,a as u,b as N,c as C}from"./dialog-h4m6KRJP.js";import{T as ie,a as le,b as y,c as k}from"./tabs-CdeGy1fN.js";import{T as P,a as $,b as p,c as r,d as H,e as c}from"./table-DFxtelq1.js";import{D as re,a as ce,b as de,c as R,S as w,X as oe}from"./use-mobile-navigation-xAdiOegP.js";import{T as me}from"./textarea-0Uq4mV0-.js";import{P as xe}from"./PeopleSelector-BZjYwcVd.js";import{E as he,C as je}from"./ellipsis-CcmptPFd.js";import{P as ue}from"./pencil-D_Mfv_xm.js";import{T as pe}from"./trash-2-D2cVRMBt.js";import"./sonner-BAI07Ub3.js";import"./briefcase-business-D4N79Uzy.js";import"./users-Dz1g4iLP.js";import"./user-plus-BCs7l9Mm.js";import"./index-DDuQ3gsv.js";import"./index-CsbLVuVn.js";import"./plus-DzSRa0oY.js";o.extend(ee);const fe={Admin:"bg-amber-600 text-white",Agent:"bg-sky-600 text-white",Client:"bg-emerald-600 text-white",User:"bg-violet-600 text-white"};function ge(l){const t=[];return l.admin_id&&t.push("Admin"),l.agent_id&&t.push("Agent"),l.client_id&&t.push("Client"),l.user_id&&t.push("User"),t.length||t.push("Standalone"),t}function Ue(){var Y;const{contact:l}=X().props,t=l,S=t.events??[],T=t.histories??[],D=(t.links??[]).map(s=>({id:s.id,relation:s.relation,other:s.related_contact_id===t.id?s.contact:s.related})),[z,f]=d.useState(!1),[U,m]=d.useState(!1),[V,x]=d.useState(!1),[g,M]=d.useState(""),[b,_]=d.useState(null),[v,A]=d.useState([]),[E,L]=d.useState("Spouse"),{reset:q}=G(),F=()=>{n.post(route("admin.contacts.history.store",t.id),{note:g},{onSuccess:()=>{h.success("Note added"),M(""),m(!1),n.reload({only:["contact"]})},onError:()=>h.error("Save failed")})},I=()=>{const s=v.at(0);s&&n.post(route("admin.contacts.links.store",t.id),{related_contact_id:s.id,relation:E},{onSuccess:()=>{h.success("Contact linked"),A([]),L("Spouse"),x(!1),q(),n.reload({only:["contact"]})},onError:()=>h.error("Add link failed")})},K=s=>{n.delete(route("admin.contacts.links.destroy",[t.id,s]),{},{onSuccess:()=>n.reload({only:["contact"]})})},Q=[{title:"Home",href:"/admin/dashboard"},{title:"Contacts",href:"/admin/contacts"},{title:`${t.firstname} ${t.lastname}`,href:"#"}];return e.jsxs(se,{breadcrumbs:Q,children:[e.jsx(J,{title:"Contact details"}),e.jsxs("div",{className:"mx-auto mt-4 max-w-5xl space-y-6",children:[e.jsxs(te,{children:[e.jsxs(ae,{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(ne,{className:"text-2xl",children:[t.firstname," ",t.lastname]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ge(t).map(s=>e.jsx(W,{className:fe[s]??"bg-gray-500 text-white",children:s==="Standalone"?"—":s},s))})]}),e.jsxs(re,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(a,{size:"icon",variant:"ghost",children:e.jsx(he,{className:"h-5 w-5"})})}),e.jsxs(de,{align:"end",children:[e.jsx(R,{asChild:!0,children:e.jsxs(B,{href:route("admin.contacts.edit",t.id),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"})," Edit"]})}),e.jsx(w,{className:"my-1"}),e.jsxs(R,{className:"text-red-600 focus:bg-red-50",onClick:()=>f(!0),children:[e.jsx(pe,{className:"h-4 w-4 mr-2"})," Delete"]})]})]})]}),e.jsxs(ie,{defaultValue:"details",className:"px-6 pb-6",children:[e.jsxs(le,{className:"mb-4",children:[e.jsx(y,{value:"details",children:"Details"}),e.jsx(y,{value:"activities",children:"Activities"}),e.jsx(y,{value:"history",children:"History"})]}),e.jsxs(k,{value:"details",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{label:"Prefix",value:t.prefix}),e.jsx(i,{label:"Middle",value:t.middle}),e.jsx(i,{label:"Phone",value:t.phone}),e.jsx(i,{label:"Email",value:t.email}),e.jsx(i,{label:"Company",value:t.company}),e.jsx(i,{label:"Address",value:`${t.address??""} ${t.city??""} ${t.zipcode??""}`}),e.jsx(i,{label:"Created",value:o(t.created_at).format("MMM D YYYY")}),e.jsx(i,{label:"Updated",value:o(t.updated_at).fromNow()}),e.jsx(i,{label:"Creator",value:(Y=t.creator)==null?void 0:Y.email})]}),e.jsx(w,{className:"my-6"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Linked contacts"}),e.jsx(a,{size:"sm",onClick:()=>x(!0),children:"+ Link contact"})]}),D.length?e.jsx("ul",{className:"mt-2 space-y-1",children:D.map(s=>e.jsxs("li",{className:"flex items-center justify-between gap-2",children:[e.jsxs(B,{href:route("admin.contacts.show",s.other.id),className:"text-sm underline",children:[s.other.firstname," ",s.other.lastname]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.relation}),e.jsx(a,{size:"icon",variant:"ghost",onClick:()=>K(s.id),children:e.jsx(oe,{className:"h-4 w-4"})})]},s.id))}):e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"No linked contacts."}),t.notes&&e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"my-6"}),e.jsx("h4",{className:"mb-2 text-sm font-medium text-muted-foreground",children:"Notes"}),e.jsx("p",{className:"whitespace-pre-line text-sm leading-relaxed",children:t.notes})]})]}),e.jsx(k,{value:"activities",children:S.length?e.jsxs(P,{children:[e.jsx($,{children:e.jsxs(p,{children:[e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Title"}),e.jsx(r,{children:"Status"})]})}),e.jsx(H,{children:S.map(s=>e.jsxs(p,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>_(s),children:[e.jsx(c,{children:o(s.start_datetime).format("MMM D YYYY h:mm A")}),e.jsx(c,{children:s.activity_type}),e.jsx(c,{children:s.title}),e.jsx(c,{children:s.status})]},s.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No activities."})}),e.jsxs(k,{value:"history",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(a,{size:"sm",onClick:()=>m(!0),children:"+ Quick note"})}),T.length?e.jsxs(P,{children:[e.jsx($,{children:e.jsxs(p,{children:[e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Details"}),e.jsx(r,{children:"By"})]})}),e.jsx(H,{children:T.map(s=>{var O;return e.jsxs(p,{children:[e.jsx(c,{children:o(s.created_at).format("MMM D YYYY h:mm A")}),e.jsx(c,{children:s.type}),e.jsx(c,{className:"whitespace-pre-line",children:s.details}),e.jsx(c,{children:((O=s.creator)==null?void 0:O.email)??"—"})]},s.id)})})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No history yet."})]})]})]}),e.jsxs(a,{variant:"secondary",onClick:()=>n.visit("/admin/contacts"),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Back to list"]})]}),e.jsx(j,{open:U,onOpenChange:m,children:e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(C,{children:"Add quick note"})}),e.jsx(me,{value:g,onChange:s=>M(s.target.value),placeholder:"Type your note…"}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(a,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(a,{disabled:!g.trim(),onClick:F,children:"Save"})]})]})}),e.jsx(j,{open:V,onOpenChange:x,children:e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(C,{children:"Link a contact"})}),e.jsx(xe,{value:v,onChange:A}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Relation"}),e.jsx("select",{className:"w-full rounded-md border p-2 text-sm",value:E,onChange:s=>L(s.target.value),children:["Spouse","Child","Parent","Sibling","Coworker","Business Partner","Other"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(a,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx(a,{disabled:!v.length,onClick:I,children:"Link"})]})]})}),e.jsx(j,{open:!!b,onOpenChange:()=>_(null),children:e.jsx(u,{className:"max-w-2xl",children:b&&e.jsx(Z,{event:b})})}),e.jsx(j,{open:z,onOpenChange:f,children:e.jsxs(u,{children:[e.jsx(N,{children:e.jsx(C,{children:"Delete this contact?"})}),e.jsx("p",{className:"py-2 text-sm",children:"This can’t be undone."}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(a,{variant:"secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx(a,{variant:"destructive",onClick:()=>n.delete(route("admin.contacts.destroy",t.id),{},()=>n.visit("/admin/contacts")),children:"Delete"})]})]})})]})}function i({label:l,value:t}){return e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"mr-1 font-medium text-muted-foreground",children:[l,":"]}),(t==null?void 0:t.toString().trim())||"—"]})}export{Ue as default};
