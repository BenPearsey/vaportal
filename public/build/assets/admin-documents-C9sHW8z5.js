import{K as ce,r as l,j as e,L as me,R as xe,S as i,t as he}from"./app-DUSEAaDk.js";import{A as ue}from"./app-layout-admin-bPDzceOK.js";import{C as pe,a as je,b as fe,c as ge}from"./card-DLziDOQe.js";import{I as f}from"./index-CsbLVuVn.js";import{B as t}from"./app-logo-icon-niQwcySJ.js";import{T as ve,a as Ce,b as w,c as O,d as De,e as c}from"./table-DFxtelq1.js";import{D as x,a as h,b as u,c as p}from"./dialog-h4m6KRJP.js";import{F as C}from"./use-mobile-navigation-xAdiOegP.js";import{P as X}from"./pencil-D_Mfv_xm.js";import{M as Z}from"./move-right-Ebc8C-Mb.js";import{T as ee}from"./trash-2-D2cVRMBt.js";import{F as Ne}from"./file-text-Lb0kZEB0.js";import{E as ke}from"./eye-Dzot2m_d.js";import{D as Se}from"./download-CYFmTqDM.js";import"./sonner-BAI07Ub3.js";import"./briefcase-business-D4N79Uzy.js";import"./users-Dz1g4iLP.js";import"./user-plus-BCs7l9Mm.js";import"./index-DDuQ3gsv.js";const ze=[{title:"Home",href:"/admin/dashboard"},{title:"Admin Documents",href:"/admin/admin-documents"}],D=j=>j==null?"":String(j);function Ke(){const{folders:j=[],documents:se=[]}=ce().props,[N,P]=l.useState([{id:0,name:"Root",parent_id:null}]),a=N[N.length-1],H=j.filter(s=>a.id===0?s.parent_id==null:s.parent_id===a.id),B=se.filter(s=>a.id===0?s.folder_id==null:s.folder_id===a.id),[I,ne]=l.useState(""),J=s=>s.toLowerCase().includes(I.toLowerCase()),[te,y]=l.useState(!1),[R,$]=l.useState(""),[r,k]=l.useState(null),[o,S]=l.useState(null),[z,F]=l.useState(null),[_,b]=l.useState(null),[g,v]=l.useState(null),[le,A]=l.useState(!1),[K,Y]=l.useState(null),[U,E]=l.useState(""),d=s=>({onSuccess:()=>{he.success(s),i.reload({only:["folders","documents"]})}}),ae=(s,n)=>i.post(route("admin.admin-documents.folders.rename",{folder:s}),{name:n},d("Folder renamed")),ie=(s,n)=>i.post(route("admin.admin-documents.rename",s),{title:n},d("Document renamed")),L=(s,n)=>i.post(route("admin.admin-documents.folders.move",{folder:s}),{parent_id:D(n)},d("Folder moved")),M=(s,n)=>i.post(route("admin.admin-documents.move",s),{folder_id:D(n)},d("Document moved")),re=s=>i.delete(route("admin.admin-documents.folders.destroy",{folder:s}),d("Folder deleted")),oe=s=>i.delete(route("admin.admin-documents.destroy",s),d("Document deleted")),q=(s,n,m)=>{s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("application/json",JSON.stringify({kind:m,id:n}))},G=(s,n)=>{var W;s.preventDefault();const m=(W=s.dataTransfer.files)==null?void 0:W[0];if(m){const T=new FormData;T.append("file",m),T.append("title",U||m.name),T.append("folder_id",D(n)),i.post(route("admin.admin-documents.store"),T,d("Uploaded"));return}const Q=s.dataTransfer.getData("application/json");if(!Q)return;const{kind:de,id:V}=JSON.parse(Q);de==="folder"?L(V,n):M(V,n)};return e.jsxs(ue,{breadcrumbs:ze,children:[e.jsx(me,{title:"Admin Documents"}),e.jsxs(pe,{className:"h-full flex flex-col",children:[e.jsxs(je,{className:"flex flex-col sm:flex-row sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(fe,{children:"Admin Documents"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:N.map((s,n)=>e.jsxs(xe.Fragment,{children:[n>0&&e.jsx("span",{children:" / "}),e.jsx("span",{className:"font-medium",children:s.name})]},s.id))})]}),e.jsxs("div",{className:"flex gap-2 mt-4 sm:mt-0",children:[N.length>1&&e.jsx(t,{variant:"outline",size:"sm",onClick:()=>P(s=>s.slice(0,-1)),children:"Back"}),e.jsx(t,{size:"sm",onClick:()=>y(!0),children:"New Folder"}),e.jsx(t,{size:"sm",onClick:()=>A(!0),children:"Upload"})]})]}),e.jsxs(ge,{className:"p-4 flex-1 overflow-auto",children:[e.jsx(f,{placeholder:"Search…",value:I,onChange:s=>ne(s.target.value),className:"max-w-xs mb-4"}),e.jsxs(ve,{children:[e.jsx(Ce,{children:e.jsxs(w,{children:[e.jsx(O,{children:"Name"}),e.jsx(O,{children:"Type"}),e.jsx(O,{children:"Uploaded"}),e.jsx(O,{className:"text-right",children:"Actions"})]})}),e.jsxs(De,{children:[H.filter(s=>J(s.name)).map(s=>e.jsxs(w,{onClick:()=>P(n=>[...n,s]),draggable:!0,onDragStart:n=>q(n,s.id,"folder"),onDragOver:n=>n.preventDefault(),onDrop:n=>G(n,s.id),className:"cursor-pointer hover:bg-muted",children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(C,{size:18})," ",s.name]}),e.jsx(c,{children:"Folder"}),e.jsx(c,{children:"—"}),e.jsxs(c,{className:"text-right space-x-2",children:[e.jsx(t,{variant:"ghost",size:"icon",onClick:n=>{n.stopPropagation(),k({id:s.id,name:s.name})},children:e.jsx(X,{size:16})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:n=>{n.stopPropagation(),F(s.id)},children:e.jsx(Z,{size:16})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:n=>{n.stopPropagation(),v({kind:"folder",id:s.id})},children:e.jsx(ee,{size:16,className:"text-red-600"})})]})]},`f-${s.id}`)),B.filter(s=>J(s.title??s.url??"")).map(s=>e.jsxs(w,{draggable:!0,onDragStart:n=>q(n,s.id,"doc"),children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(Ne,{size:18})," ",s.title]}),e.jsx(c,{children:"File"}),e.jsx(c,{children:new Date(s.created_at).toLocaleDateString()}),e.jsxs(c,{className:"text-right space-x-2",children:[e.jsx("a",{href:route("admin.admin-documents.view",s.id),target:"_blank",rel:"noreferrer",children:e.jsx(t,{variant:"ghost",size:"icon",children:e.jsx(ke,{size:16})})}),e.jsx("a",{href:route("admin.admin-documents.view",s.id),download:!0,children:e.jsx(t,{variant:"ghost",size:"icon",children:e.jsx(Se,{size:16})})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>S({id:s.id,title:s.title||""}),children:e.jsx(X,{size:16})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>b(s.id),children:e.jsx(Z,{size:16})}),e.jsx(t,{variant:"ghost",size:"icon",onClick:()=>v({kind:"doc",id:s.id}),children:e.jsx(ee,{size:16,className:"text-red-600"})})]})]},`d-${s.id}`)),H.length===0&&B.length===0&&e.jsx(w,{children:e.jsx(c,{colSpan:4,className:"text-center text-muted-foreground",children:"Empty folder"})})]})]}),e.jsxs("div",{className:"border-2 border-dashed rounded p-6 text-center mt-6 text-muted-foreground",onDragOver:s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},onDrop:s=>G(s,a.id===0?null:a.id),children:["Drag & drop files here to upload into ",e.jsx("strong",{children:a.name})]})]})]}),e.jsx(x,{open:te,onOpenChange:y,children:e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(p,{children:"Create Folder"})}),e.jsx(f,{value:R,onChange:s=>$(s.target.value),placeholder:"Folder name"}),e.jsx(t,{className:"mt-4",disabled:!R.trim(),onClick:()=>{i.post(route("admin.admin-documents.folders.store"),{folder:1,name:R,parent_id:D(a.id===0?null:a.id)},d("Folder created")),$(""),y(!1)},children:"Create"})]})}),e.jsx(x,{open:le,onOpenChange:A,children:e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(p,{children:"Upload"})}),e.jsx(f,{type:"file",onChange:s=>{var m;const n=(m=s.target.files)==null?void 0:m[0];n&&(Y(n),E(n.name))}}),e.jsx(f,{className:"mt-2",value:U,onChange:s=>E(s.target.value),placeholder:"Title"}),e.jsx(t,{className:"mt-4",disabled:!K,onClick:()=>{const s=new FormData;s.append("file",K),s.append("title",U),s.append("folder_id",D(a.id===0?null:a.id)),i.post(route("admin.admin-documents.store"),s,d("Uploaded")),A(!1),Y(null),E("")},children:"Upload"})]})}),e.jsx(x,{open:!!r,onOpenChange:()=>k(null),children:e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(p,{children:"Rename Folder"})}),e.jsx(f,{value:(r==null?void 0:r.name)||"",onChange:s=>k(r?{...r,name:s.target.value}:null)}),e.jsx(t,{className:"mt-4",onClick:()=>{r&&ae(r.id,r.name),k(null)},children:"Save"})]})}),e.jsx(x,{open:!!o,onOpenChange:()=>S(null),children:e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(p,{children:"Rename Document"})}),e.jsx(f,{value:(o==null?void 0:o.title)||"",onChange:s=>S(o?{...o,title:s.target.value}:null)}),e.jsx(t,{className:"mt-4",onClick:()=>{o&&ie(o.id,o.title),S(null)},children:"Save"})]})}),e.jsx(x,{open:z!=null,onOpenChange:()=>F(null),children:e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(p,{children:"Move Folder"})}),e.jsxs(t,{variant:"outline",onClick:()=>{L(z,null),F(null)},children:[e.jsx(C,{size:16,className:"mr-2"})," Root"]}),j.filter(s=>s.id!==z).map(s=>e.jsxs(t,{variant:"outline",className:"mt-2",onClick:()=>{L(z,s.id),F(null)},children:[e.jsx(C,{size:16,className:"mr-2"})," ",s.name]},s.id))]})}),e.jsx(x,{open:_!=null,onOpenChange:()=>b(null),children:e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(p,{children:"Move Document"})}),e.jsxs(t,{variant:"outline",onClick:()=>{M(_,null),b(null)},children:[e.jsx(C,{size:16,className:"mr-2"})," Root"]}),j.map(s=>e.jsxs(t,{variant:"outline",className:"mt-2",onClick:()=>{M(_,s.id),b(null)},children:[e.jsx(C,{size:16,className:"mr-2"})," ",s.name]},s.id))]})}),e.jsx(x,{open:!!g,onOpenChange:()=>v(null),children:e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(p,{children:"Delete permanently?"})}),e.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[e.jsx(t,{variant:"destructive",onClick:()=>{g&&(g.kind==="folder"?re(g.id):oe(g.id),v(null))},children:"Yes"}),e.jsx(t,{onClick:()=>v(null),children:"Cancel"})]})]})})]})}export{Ke as default};
