import{r as c,j as e,t as p,S as a,$ as ge,K as Le,L as Pe}from"./app-DUSEAaDk.js";import{d as de,B as Ie}from"./badge-Dp8nKuAQ.js";import{E as He,r as Ve}from"./EventViewer-D5uvhi8T.js";import{A as qe}from"./app-layout-admin-bPDzceOK.js";import{C as P,a as oe,b as xe,c as W}from"./card-DLziDOQe.js";import{T as Re,a as Te,b as U,c as A}from"./tabs-CdeGy1fN.js";import{T as Xe,a as Ge,b as Oe,c as Ne,d as Ke,e as Ce}from"./table-DFxtelq1.js";import{F as ze,D as Qe,a as Je,b as We,c as Ue,S as Ae}from"./use-mobile-navigation-xAdiOegP.js";import{c as Ze,B as r}from"./app-logo-icon-niQwcySJ.js";import{I as q}from"./index-CsbLVuVn.js";import{T as Me}from"./textarea-0Uq4mV0-.js";import{D as E,a as z,b as H,c as V,e as es}from"./dialog-h4m6KRJP.js";import{U as $e}from"./upload-BGDiebbv.js";import{F as Be}from"./file-text-Lb0kZEB0.js";import{A as ss}from"./AgentChecklist-BMl7pJnH.js";import{T as ye}from"./trash-2-D2cVRMBt.js";import{E as ts,C as ns}from"./ellipsis-CcmptPFd.js";import{P as ls}from"./pencil-D_Mfv_xm.js";import"./sonner-BAI07Ub3.js";import"./briefcase-business-D4N79Uzy.js";import"./users-Dz1g4iLP.js";import"./user-plus-BCs7l9Mm.js";import"./index-DDuQ3gsv.js";import"./Checklist-Df5g09Pz.js";import"./checkbox-Dj6NJVxR.js";import"./index-BxwQjuZr.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],ds=Ze("PenLine",as);function os({contactId:s,folders:f,documents:X,onFileUpload:B,onDeleteDocument:x,onMoveDocument:g,onRenameDocument:$,onCreateFolder:F,onRenameFolder:R,onMoveFolder:Y,onDeleteFolder:_}){const I={id:0,name:"General",parent_id:null},[v,w]=c.useState([I]),N=v.at(-1),[C,o]=c.useState(!1),[h,n]=c.useState(null),[i,k]=c.useState(""),[O,se]=c.useState(!1),[G,d]=c.useState(""),[j,T]=c.useState(!1),[M,be]=c.useState(null),[ce,he]=c.useState(""),[De,re]=c.useState(!1),[pe,we]=c.useState(null),[te,ne]=c.useState(""),[Se,L]=c.useState(!1),[le,ke]=c.useState(null),[je,ie]=c.useState(!1),[fe,ve]=c.useState(null),[K,Q]=c.useState(null),[Z,me]=c.useState(null),ue=c.useRef(null);c.useEffect(()=>{const t=()=>{Q(null),me(null)};return window.addEventListener("click",t),()=>window.removeEventListener("click",t)},[]);const Fe=f.filter(t=>N.id===0?t.parent_id===null:t.parent_id===N.id),l=X.filter(t=>N.id===0?t.folder_id===null:t.folder_id===N.id),S=[...Fe.map(t=>({type:"folder",...t})),...l.map(t=>({type:"doc",...t}))].sort((t,u)=>{if(t.type===u.type){const m=t.type==="folder"?t.name:t.title||t.path,D=u.type==="folder"?u.name:u.title||u.path;return String(m).localeCompare(String(D))}return t.type==="folder"?-1:1}),y=()=>{h&&(B(h,N.id,i),o(!1),n(null),k(""))},b=()=>{F(G,N.id===0?null:N.id),se(!1),d("")};return e.jsxs("div",{className:"flex flex-col h-full relative",ref:ue,children:[e.jsxs("div",{className:"p-4 border-b flex flex-wrap items-center justify-between gap-4",children:[e.jsx("div",{className:"font-semibold",children:N.id===0?"My Documents":N.name}),e.jsxs("div",{className:"flex gap-2",children:[v.length>1&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>w(v.slice(0,-1)),children:"Back"}),e.jsxs(r,{size:"sm",onClick:()=>o(!0),children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Upload"]}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>se(!0),children:"New folder"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:S.length===0?e.jsxs("div",{className:`h-full flex flex-col items-center justify-center
                       border-2 border-dashed rounded text-muted-foreground`,onDragOver:t=>t.preventDefault(),onDrop:t=>{var m;t.preventDefault();const u=(m=t.dataTransfer.files)==null?void 0:m[0];u&&(n(u),k(u.name),o(!0))},children:[e.jsx($e,{className:"h-12 w-12 mb-4"}),"Drag files here or click Upload"]}):e.jsxs("div",{className:`grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))]
                       gap-4`,children:[S.map(t=>{var u;return t.type==="folder"?e.jsxs("div",{className:`flex flex-col items-center p-3 border rounded
                             cursor-pointer hover:bg-muted/50`,onClick:()=>w([...v,t]),onContextMenu:m=>{var ee;m.preventDefault();const D=(ee=ue.current)==null?void 0:ee.getBoundingClientRect();me({id:t.id,x:m.clientX-((D==null?void 0:D.left)??0),y:m.clientY-((D==null?void 0:D.top)??0)})},onDragOver:m=>m.preventDefault(),onDrop:m=>{m.preventDefault();const D=Number(m.dataTransfer.getData("doc"));D&&g(D,t.id)},children:[e.jsx(ze,{className:"h-8 w-8 mb-1"}),e.jsx("span",{className:"truncate w-full text-center text-sm",children:t.name})]},`folder-${t.id}`):e.jsxs("div",{className:"flex flex-col items-center",draggable:!0,onDragStart:m=>m.dataTransfer.setData("doc",String(t.id)),onDoubleClick:()=>window.open(route("admin.contacts.documents.view",{contact:s,document:t.id}),"_blank"),onContextMenu:m=>{var ee;m.preventDefault();const D=(ee=ue.current)==null?void 0:ee.getBoundingClientRect();Q({id:t.id,x:m.clientX-((D==null?void 0:D.left)??0),y:m.clientY-((D==null?void 0:D.top)??0)})},children:[e.jsx(Be,{className:"h-10 w-10"}),e.jsx("span",{className:"mt-1 break-all text-xs text-center",children:((u=t.title)==null?void 0:u.trim())||t.path.split("/").pop()})]},`doc-${t.id}`)}),e.jsx("div",{className:`border border-dashed rounded p-4 col-span-full
                         text-center text-sm`,onDragOver:t=>t.preventDefault(),onDrop:t=>{var m;t.preventDefault();const u=(m=t.dataTransfer.files)==null?void 0:m[0];u&&(n(u),k(u.name),o(!0))},children:"Drag & drop here to upload"})]})}),e.jsx(E,{open:C,onOpenChange:o,children:e.jsxs(z,{children:[e.jsxs(H,{children:[e.jsx(V,{children:"Upload document"}),e.jsx(es,{children:"Choose a file and (optionally) set a title."})]}),e.jsx(q,{type:"file",onChange:t=>{var m;const u=(m=t.target.files)==null?void 0:m[0];u&&(n(u),k(u.name))}}),e.jsx(q,{placeholder:"Title",value:i,onChange:t=>k(t.target.value)}),e.jsx(r,{onClick:y,disabled:!h,children:"Upload"})]})}),e.jsx(E,{open:O,onOpenChange:se,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"New folder"})}),e.jsx(q,{placeholder:"Folder name",value:G,onChange:t=>d(t.target.value)}),e.jsx(r,{onClick:b,disabled:!G.trim(),children:"Create"})]})}),e.jsx(E,{open:j,onOpenChange:T,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Rename document"})}),e.jsx(q,{value:ce,onChange:t=>he(t.target.value)}),e.jsx(r,{onClick:()=>{M!==null&&($(M,ce),T(!1))},children:"Save"})]})}),e.jsx(E,{open:De,onOpenChange:re,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Rename folder"})}),e.jsx(q,{value:te,onChange:t=>ne(t.target.value)}),e.jsx(r,{onClick:()=>{pe!==null&&(R(pe,te),re(!1))},children:"Save"})]})}),e.jsx(E,{open:Se,onOpenChange:L,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Delete folder?"})}),e.jsx("p",{className:"text-sm",children:"All documents inside will be **permanently removed**."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"secondary",onClick:()=>L(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:()=>{le!==null&&(_(le),L(!1))},children:"Delete"})]})]})}),K&&e.jsxs("div",{className:"absolute bg-white border rounded shadow text-sm z-50",style:{top:K.y,left:K.x},children:[e.jsx("div",{className:"px-3 py-1 cursor-pointer hover:bg-muted/50",onClick:()=>{var u;const t=X.find(m=>m.id===K.id);be(K.id),he(((u=t==null?void 0:t.title)==null?void 0:u.trim())||(t==null?void 0:t.path.split("/").pop())||""),T(!0),Q(null)},children:"Rename"}),e.jsx("div",{className:"px-3 py-1 cursor-pointer hover:bg-muted/50",onClick:()=>{ve(K.id),ie(!0),Q(null)},children:"Move"}),e.jsx("div",{className:"px-3 py-1 cursor-pointer hover:bg-muted/50 text-red-600",onClick:()=>{x(K.id),Q(null)},children:"Delete"})]}),Z&&e.jsxs("div",{className:"absolute bg-white border rounded shadow text-sm z-50",style:{top:Z.y,left:Z.x},children:[e.jsx("div",{className:"px-3 py-1 cursor-pointer hover:bg-muted/50",onClick:()=>{const t=f.find(u=>u.id===Z.id);we(Z.id),ne(t?t.name:""),re(!0),me(null)},children:"Rename"}),e.jsx("div",{className:"px-3 py-1 cursor-pointer hover:bg-muted/50 text-red-600",onClick:()=>{ke(Z.id),L(!0),me(null)},children:"Delete"})]}),e.jsx(ae,{open:je,onClose:()=>ie(!1),docId:fe,folders:f,onMove:t=>{fe!==null&&g(fe,t),ie(!1)}})]});function ae({open:t,onClose:u,docId:m,folders:D,onMove:ee}){return e.jsx(E,{open:t,onOpenChange:u,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Move document"})}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-auto",children:[e.jsx(r,{variant:"outline",className:"w-full justify-start",onClick:()=>ee(0),children:"General"}),D.map(_e=>e.jsx(r,{variant:"outline",className:"w-full justify-start",onClick:()=>ee(_e.id),children:_e.name},_e.id))]})]})})}}function Ye({folders:s,documents:f,onFileUpload:X,onDeleteDocument:B,onMoveDocument:x,onCreateFolder:g,onRenameDocument:$,onRenameFolder:F,onRequestDeleteDocument:R,onRequestDeleteFolder:Y,viewRoute:_,rootLabel:I="My Documents"}){const v={id:0,name:I,parent_id:null},[w,N]=c.useState([v]),C=w[w.length-1],[o,h]=c.useState(!1),[n,i]=c.useState(null),[k,O]=c.useState(""),[se,G]=c.useState(!1),[d,j]=c.useState(""),[T,M]=c.useState(null),[be,ce]=c.useState(!1),[he,De]=c.useState(null),[re,pe]=c.useState(""),[we,te]=c.useState(!1),[ne,Se]=c.useState(null),[L,le]=c.useState(null),[ke,je]=c.useState(!1),[ie,fe]=c.useState(null),[ve,K]=c.useState(""),Q=c.useRef(null);c.useEffect(()=>{const l=()=>{M(null),le(null)};return window.addEventListener("click",l),()=>window.removeEventListener("click",l)},[]);const Z=s.filter(l=>C.id===0?l.parent_id===null:l.parent_id===C.id),me=f.filter(l=>C.id===0?l.folder_id===null:l.folder_id===C.id),ue=[...Z.map(l=>({type:"folder",...l})),...me.map(l=>({type:"doc",...l}))].sort((l,S)=>{if(l.type===S.type){const y=l.type==="folder"?l.name:l.title||l.path,b=S.type==="folder"?S.name:S.title||S.path;return String(y).localeCompare(String(b))}return l.type==="folder"?-1:1}),Fe=()=>{n&&(X(n,C.id,k),p.success("Uploaded"),h(!1),i(null),O(""))};return e.jsxs("div",{className:"flex flex-col h-full relative",ref:Q,children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"mb-2 font-semibold",children:C.id===0?I:C.name}),w.length>1&&e.jsx(r,{variant:"outline",onClick:()=>N(w.slice(0,-1)),children:"Back"}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(r,{onClick:()=>G(!0),children:"Create Folder"}),e.jsxs(r,{onClick:()=>h(!0),children:[e.jsx($e,{className:"h-4 w-4 mr-1"})," Upload"]})]})]}),e.jsx("div",{className:"flex-1 p-4 overflow-auto",children:ue.length?e.jsx("div",{className:"grid grid-cols-6 gap-4",children:ue.map(l=>{var S;return l.type==="folder"?e.jsxs("div",{className:`flex flex-col items-center p-4 border rounded
                              cursor-pointer hover:bg-gray-100`,onClick:()=>N([...w,l]),onDragOver:y=>y.preventDefault(),onDrop:y=>{y.preventDefault();const b=Number(y.dataTransfer.getData("text/plain"));Number.isNaN(b)||(x(b,l.id),p.success("Document moved"))},onContextMenu:y=>{var ae;y.preventDefault();const b=(ae=Q.current)==null?void 0:ae.getBoundingClientRect();le({folderId:l.id,x:y.clientX-((b==null?void 0:b.left)??0),y:y.clientY-((b==null?void 0:b.top)??0)})},children:[e.jsx(ze,{className:"h-8 w-8 mb-2"}),e.jsx("span",{className:"text-sm",children:l.name})]},`f-${l.id}`):e.jsxs("div",{className:"flex flex-col items-center",draggable:!0,onDragStart:y=>y.dataTransfer.setData("text/plain",String(l.id)),onDoubleClick:()=>window.open(_(l.id),"_blank"),onContextMenu:y=>{var ae;y.preventDefault();const b=(ae=Q.current)==null?void 0:ae.getBoundingClientRect();M({docId:l.id,x:y.clientX-((b==null?void 0:b.left)??0),y:y.clientY-((b==null?void 0:b.top)??0)})},children:[e.jsx(Be,{className:"h-10 w-10"}),e.jsx("div",{className:"text-xs mt-1 text-center",children:((S=l.title)==null?void 0:S.trim())||l.path.split("/").pop()})]},`d-${l.id}`)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No items."})}),e.jsx(E,{open:o,onOpenChange:h,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Upload"})}),e.jsx(q,{type:"file",onChange:l=>{var y;const S=(y=l.target.files)==null?void 0:y[0];S&&(i(S),O(S.name))}}),e.jsx(q,{placeholder:"Title",value:k,onChange:l=>O(l.target.value)}),e.jsx(r,{onClick:Fe,disabled:!n,children:"Upload"})]})}),e.jsx(E,{open:se,onOpenChange:G,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Create folder"})}),e.jsx(q,{placeholder:"Folder name",value:d,onChange:l=>j(l.target.value)}),e.jsx(r,{onClick:()=>{g(d,C.id===0?null:C.id),p.success("Folder created"),G(!1),j("")},disabled:!d.trim(),children:"Create"})]})}),T&&e.jsxs("div",{className:"absolute bg-white border rounded shadow p-2 z-50",style:{top:T.y,left:T.x},children:[e.jsx("div",{className:"cursor-pointer p-1 text-sm hover:bg-gray-100",onClick:()=>{De(T.docId);const l=f.find(S=>S.id===T.docId);pe((l==null?void 0:l.title)||(l==null?void 0:l.path.split("/").pop())||""),ce(!0),M(null)},children:"Rename"}),e.jsx("div",{className:"cursor-pointer p-1 text-sm hover:bg-gray-100",onClick:()=>{Se(T.docId),te(!0),M(null)},children:"Move"}),e.jsx("div",{className:"cursor-pointer p-1 text-sm hover:bg-gray-100",onClick:()=>{R(T.docId),M(null)},children:"Delete"})]}),e.jsx(E,{open:be,onOpenChange:ce,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Rename document"})}),e.jsx(q,{value:re,onChange:l=>pe(l.target.value)}),e.jsx(r,{onClick:()=>{he!==null&&($(he,re),p.success("Renamed"),ce(!1))},children:"Save"})]})}),e.jsx(E,{open:we,onOpenChange:te,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Move document"})}),e.jsx(r,{variant:"outline",className:"w-full text-left mb-2",onClick:()=>{ne!==null&&(x(ne,0),p.success("Document moved"),te(!1))},children:I}),s.map(l=>e.jsx(r,{variant:"outline",className:"w-full text-left mb-1",onClick:()=>{ne!==null&&(x(ne,l.id),p.success("Document moved"),te(!1))},children:l.name},l.id))]})}),L&&e.jsxs("div",{className:"absolute bg-white border rounded shadow p-2 z-50",style:{top:L.y,left:L.x},children:[e.jsx("div",{className:"cursor-pointer p-1 text-sm hover:bg-gray-100",onClick:()=>{fe(L.folderId);const l=s.find(S=>S.id===L.folderId);K((l==null?void 0:l.name)||""),je(!0),le(null)},children:"Rename"}),e.jsx("div",{className:"cursor-pointer p-1 text-sm hover:bg-gray-100",onClick:()=>{Y(L.folderId),le(null)},children:"Delete"})]}),e.jsx(E,{open:ke,onOpenChange:je,children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(V,{children:"Rename folder"})}),e.jsx(q,{value:ve,onChange:l=>K(l.target.value)}),e.jsx(r,{onClick:()=>{ie!==null&&(F(ie,ve),p.success("Folder renamed"),je(!1))},children:"Save"})]})})]})}function cs({core:s,docs:f,dirs:X,notes:B,sales:x,clients:g,checklist:$}){const F=Array.isArray(x)?x:(x==null?void 0:x.data)??[],R=Array.isArray(g)?g:(g==null?void 0:g.data)??[],Y=F.length,_=F.reduce((n,i)=>{const k=parseFloat(String(i.commission??0));return n+(isNaN(k)?0:k)},0),I=`/admin/agents/${s.agent_id}`,v=n=>()=>p.success(n),[w,N]=c.useState(""),[C,o]=c.useState(null),h=n=>n?n.replace(/[_-]+/g," ").replace(/\b\w/g,i=>i.toUpperCase()):"Sale";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(P,{children:[e.jsx(oe,{children:e.jsx(xe,{children:"Profile"})}),e.jsxs(W,{className:"text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",s.phone??"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Company:"})," ",s.company??"—"]})]})]}),e.jsxs(P,{children:[e.jsx(oe,{children:e.jsx(xe,{children:"Sales"})}),e.jsxs(W,{className:"text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total sales:"})," ",Y]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total commission:"})," ",_.toLocaleString(void 0,{style:"currency",currency:"USD"})]})]})]}),e.jsxs(P,{children:[e.jsx(oe,{children:e.jsx(xe,{children:"Checklist"})}),e.jsx(W,{children:e.jsx(ss,{agentId:s.agent_id,checklist:$})})]})]}),e.jsxs(Re,{defaultValue:"docs",children:[e.jsxs(Te,{className:"mb-4",children:[e.jsx(U,{value:"docs",children:"Documents"}),e.jsx(U,{value:"notes",children:"Notes"}),e.jsx(U,{value:"clients",children:"Clients"}),e.jsx(U,{value:"sales",children:"Sales"})]}),e.jsx(A,{value:"docs",children:e.jsx(Ye,{folders:X,documents:f,viewRoute:n=>route("admin.agents.documents.view",{agent:s.agent_id,document:n}),onFileUpload:(n,i,k)=>{const O=new FormData;O.append("file",n),O.append("folder_id",String(i)),O.append("title",k),a.post(route("admin.agents.documents.upload",{agent:s.agent_id}),O,{onSuccess:v("Uploaded")})},onDeleteDocument:n=>a.delete(route("admin.agents.documents.destroy",{agent:s.agent_id,document:n}),{onSuccess:v("Deleted")}),onMoveDocument:(n,i)=>a.post(route("admin.agents.documents.move",{agent:s.agent_id,document:n}),{folder_id:i},{onSuccess:v("Moved")}),onRenameDocument:(n,i)=>a.post(route("admin.agents.documents.rename",{agent:s.agent_id,document:n}),{title:i},{onSuccess:v("Renamed")}),onCreateFolder:(n,i)=>a.post(route("admin.agents.documents.folder.store",{agent:s.agent_id}),{name:n,parent_id:i},{onSuccess:v("Folder created")}),onRenameFolder:(n,i)=>a.post(route("admin.agents.documents.folder.rename",{folder:n}),{name:i},{onSuccess:v("Folder renamed")}),onMoveFolder:(n,i)=>a.post(route("admin.agents.documents.folder.move",{folder:n}),{parent_id:i},{onSuccess:v("Folder moved")}),onDeleteFolder:n=>a.delete(route("admin.agents.documents.folder.destroy",{folder:n}),{onSuccess:v("Folder deleted")}),onRequestDeleteDocument:()=>{},onRequestDeleteFolder:()=>{}})}),e.jsxs(A,{value:"notes",className:"space-y-4",children:[B.length?B.map(n=>e.jsxs(P,{className:"flex justify-between items-start p-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:n.content}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.created_by," — ",de(n.created_at).format("MMM D YYYY")]})]}),e.jsx(r,{size:"icon",variant:"ghost",onClick:()=>o(n.id),children:e.jsx(ye,{className:"h-4 w-4 text-red-600"})})]},n.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No notes yet."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Me,{value:w,onChange:n=>N(n.target.value),rows:3,className:"flex-1"}),e.jsx(r,{disabled:!w.trim(),onClick:()=>a.post(route("admin.agents.notes.store",{agent:s.agent_id}),{content:w},{onSuccess:()=>{p.success("Note added"),N(""),a.reload({only:["notes"]})}}),children:"Add"})]}),C&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{children:"Delete note?"}),e.jsx(r,{size:"sm",variant:"destructive",onClick:()=>a.delete(`${I}/notes/${C}`,{onSuccess:()=>{p.success("Note deleted"),a.reload({only:["notes"]})}}).then(()=>o(null)),children:"Delete"}),e.jsx(r,{size:"sm",variant:"secondary",onClick:()=>o(null),children:"Cancel"})]})]}),e.jsx(A,{value:"clients",children:R.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map(n=>{var k;const i=n.contact_id??((k=n.contact)==null?void 0:k.id)??void 0;return e.jsx(P,{className:"hover:shadow-lg",children:e.jsxs(W,{className:"p-4 flex flex-col gap-2",children:[e.jsxs("div",{className:"font-medium",children:[n.firstname," ",n.lastname]}),i?e.jsx(ge,{href:`/admin/contacts/${i}/hub`,className:"text-sm text-blue-600 hover:underline",children:"Open contact hub"}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"(no contact record)"})]})},n.client_id??n.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No clients for this agent."})}),e.jsx(A,{value:"sales",children:F.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(n=>e.jsx(P,{className:"hover:shadow-lg",children:e.jsxs(W,{className:"p-4 flex flex-col gap-2",children:[e.jsx("div",{className:"font-medium",children:h(n.product)}),e.jsx("div",{className:"text-sm",children:(n.total_sale_amount??n.amount).toLocaleString(void 0,{style:"currency",currency:"USD"})}),e.jsx(ge,{href:route("admin.sales.show",{sale:n.id??n.sale_id}),className:"text-sm text-blue-600 hover:underline",children:"View sale"})]})},n.id??n.sale_id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No sales recorded."})})]})]})}const Ee=(s,f=4)=>s?"•••• "+s.slice(-f):"N/A";function rs({core:s,docs:f,dirs:X,notes:B}){var w,N,C;const x=`/admin/clients/${s.client_id}`,g=o=>()=>p.success(o),[$,F]=c.useState(""),[R,Y]=c.useState(null),[_,I]=c.useState(!1),v=((w=s.agent)==null?void 0:w.contact_id)??((C=(N=s.agent)==null?void 0:N.contact)==null?void 0:C.id)??void 0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(P,{children:[e.jsx(oe,{children:e.jsx(xe,{children:"Profile"})}),e.jsxs(W,{className:"grid gap-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"}),"  ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"}),"  ",s.phone??"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),s.agent&&v&&e.jsxs("p",{children:[e.jsx("strong",{children:"Agent:"})," ",e.jsxs(ge,{href:`/admin/contacts/${v}/hub`,className:"text-blue-600 hover:underline",children:[s.agent.firstname," ",s.agent.lastname]})]})]})]}),e.jsxs(P,{children:[e.jsxs(oe,{className:"flex items-center justify-between",children:[e.jsx(xe,{children:"Banking Details"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>I(!_),children:_?"Hide numbers":"Show full numbers"})]}),e.jsxs(W,{className:"grid gap-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Bank:"})," ",s.bank_name??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Account Type:"})," ",s.account_type??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Account Holder:"})," ",s.account_holder??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Routing #:"})," ",_?s.routing_number??"N/A":Ee(s.routing_number)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Account #:"})," ",_?s.account_number??"N/A":Ee(s.account_number)]})]})]})]}),e.jsxs(Re,{defaultValue:"docs",children:[e.jsxs(Te,{className:"mb-4",children:[e.jsx(U,{value:"docs",children:"Documents"}),e.jsx(U,{value:"notes",children:"Notes"})]}),e.jsx(A,{value:"docs",children:e.jsx(Ye,{folders:X,documents:f,viewRoute:o=>route("admin.clients.documents.view",{client:s.client_id,document:o}),onFileUpload:(o,h,n)=>{const i=new FormData;i.append("file",o),i.append("folder_id",h.toString()),i.append("title",n),a.post(`${x}/documents/upload`,i,{onSuccess:g("Uploaded")})},onDeleteDocument:o=>a.delete(`${x}/documents/${o}`,{onSuccess:g("Deleted")}),onMoveDocument:(o,h)=>a.post(`${x}/documents/${o}/move`,{folder_id:h},{onSuccess:g("Moved")}),onRenameDocument:(o,h)=>a.post(`${x}/documents/${o}/rename`,{title:h},{onSuccess:g("Renamed")}),onCreateFolder:(o,h)=>a.post(`${x}/documents/folder`,{name:o,parent_id:h},{onSuccess:g("Folder created")}),onRenameFolder:(o,h)=>a.post(`${x}/documents/folder/${o}/rename`,{name:h},{onSuccess:g("Folder renamed")}),onMoveFolder:(o,h)=>a.post(`${x}/documents/folder/${o}/move`,{parent_id:h},{onSuccess:g("Folder moved")}),onDeleteFolder:o=>a.delete(`${x}/documents/folder/${o}`,{onSuccess:g("Folder deleted")}),onRequestDeleteDocument:()=>{},onRequestDeleteFolder:()=>{}})}),e.jsxs(A,{value:"notes",className:"space-y-4",children:[B.length?B.map(o=>e.jsxs(P,{className:"flex justify-between p-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:o.content}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.created_by," — ",de(o.created_at).format("MMM D YYYY")]})]}),e.jsx(r,{size:"icon",variant:"ghost",onClick:()=>Y(o.id),children:e.jsx(ye,{className:"h-4 w-4 text-red-600"})})]},o.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No notes yet."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Me,{value:$,onChange:o=>F(o.target.value),rows:3,className:"flex-1"}),e.jsx(r,{disabled:!$.trim(),onClick:()=>a.post(`${x}/notes/store`,{content:$},{onSuccess:()=>{p.success("Note added"),F(""),a.reload({only:["notes"]})}}),children:"Add"})]}),R&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{children:"Delete note?"}),e.jsx(r,{size:"sm",variant:"destructive",onClick:()=>a.delete(`${x}/notes/${R}`,{onSuccess:()=>{p.success("Note deleted"),a.reload({only:["notes"]})}}).then(()=>Y(null)),children:"Delete"}),e.jsx(r,{size:"sm",variant:"secondary",onClick:()=>Y(null),children:"Cancel"})]})]})]})]})}de.extend(Ve);const is={Admin:"bg-amber-600 text-white",Agent:"bg-sky-600 text-white",Client:"bg-emerald-600 text-white",User:"bg-violet-600 text-white"},ms=s=>s.length?s.map(f=>e.jsx(Ie,{className:is[f]??"bg-gray-500 text-white",children:f},f)):e.jsx(Ie,{className:"bg-gray-500 text-white",children:"—"}),J=({label:s,value:f})=>e.jsxs("p",{className:"text-sm",children:[e.jsxs("span",{className:"mr-1 font-medium text-muted-foreground",children:[s,":"]}),(f==null?void 0:f.toString().trim())||"—"]});function Es(){var G;const{contact:s,folders:f=[],documents:X=[],events:B=[],histories:x=[],links:g=[],client:$=null,agent:F=null}=Le().props,[R,Y]=c.useState(null),[_,I]=c.useState(""),[v,w]=c.useState(null),[N,C]=c.useState(""),o=`/admin/contacts/${s.id}/documents`,h=`/admin/contacts/${s.id}/history`,n=[{title:"Home",href:"/admin/dashboard"},{title:"Contacts",href:"/admin/contacts"},{title:`${s.firstname} ${s.lastname}`,href:"#"}],i=()=>{_.trim()&&a.post(route("admin.contacts.history.store",{contact:s.id}),{note:_},{onSuccess:()=>{p.success("Note added"),I(""),a.reload({only:["histories"]})}})},k=d=>{w(d.id),C(d.details)},O=()=>{v!==null&&a.put(`${h}/${v}`,{details:N},{onSuccess:()=>{p.success("Note updated"),w(null),C(""),a.reload({only:["histories"]})}})},se=d=>a.delete(`${h}/${d}`,{onSuccess:()=>{p.success("Note deleted"),a.reload({only:["histories"]})}});return e.jsxs(qe,{breadcrumbs:n,children:[e.jsx(Pe,{title:`Contact – ${s.firstname} ${s.lastname}`}),e.jsx(P,{className:"mx-auto mt-4 max-w-5xl",children:e.jsxs(oe,{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(xe,{className:"text-2xl",children:[s.firstname," ",s.lastname]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ms(s.roles)})]}),e.jsxs(Qe,{children:[e.jsx(Je,{asChild:!0,children:e.jsx(r,{size:"icon",variant:"ghost",children:e.jsx(ts,{className:"h-5 w-5"})})}),e.jsxs(We,{align:"end",children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(ge,{href:`/admin/contacts-edit/${s.id}`,children:[e.jsx(ls,{className:"h-4 w-4 mr-2"})," Edit"]})}),e.jsx(Ae,{className:"my-1"}),e.jsxs(Ue,{className:"text-red-600 focus:bg-red-50",onClick:()=>a.delete(`/admin/contacts/${s.id}`,{},()=>a.visit("/admin/contacts")),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"})," Delete"]})]})]})]})}),e.jsxs(Re,{defaultValue:"overview",className:"mt-6 space-y-6",children:[e.jsxs(Te,{className:"sticky top-0 z-10 bg-background/90 backdrop-blur",children:[e.jsx(U,{value:"overview",children:"Overview"}),e.jsx(U,{value:"activities",children:"Activities"}),e.jsx(U,{value:"documents",children:"Documents"}),e.jsx(U,{value:"notes",children:"Notes"}),$&&e.jsx(U,{value:"client",children:"Client"}),F&&e.jsx(U,{value:"agent",children:"Agent"})]}),e.jsx(A,{value:"overview",children:e.jsx("section",{className:"min-h-[60vh] mx-auto max-w-5xl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-6",children:[e.jsx(J,{label:"Prefix",value:s.prefix}),e.jsx(J,{label:"Middle",value:s.middle}),e.jsx(J,{label:"Phone",value:s.phone}),e.jsx(J,{label:"Email",value:s.email}),e.jsx(J,{label:"Company",value:s.company}),e.jsx(J,{label:"Address",value:`${s.address??""} ${s.city??""} ${s.zipcode??""}`}),e.jsx(J,{label:"Created",value:de(s.created_at).format("MMM D YYYY")}),e.jsx(J,{label:"Updated",value:de(s.updated_at).fromNow()}),e.jsx(J,{label:"Creator",value:(G=s.creator)==null?void 0:G.email}),g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"my-4 col-span-full"}),e.jsx("h4",{className:"text-sm font-semibold col-span-full",children:"Linked contacts"}),e.jsx("ul",{className:"space-y-1 col-span-full",children:g.map(d=>{const j=d.contact_id===s.id?d.related:d.contact;return e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsxs(ge,{className:"text-primary hover:underline",href:`/admin/contacts/${j.id}/hub`,children:[j.firstname," ",j.lastname]}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>a.delete(`/admin/contacts/${s.id}/links/${d.id}`,{onSuccess:()=>a.reload({only:["links"]})}),children:"Unlink"})]},d.id)})})]})]})})}),e.jsx(A,{value:"activities",children:e.jsx("section",{className:"min-h-[60vh] mx-auto max-w-5xl",children:B.length?e.jsxs(Xe,{children:[e.jsx(Ge,{children:e.jsxs(Oe,{children:[e.jsx(Ne,{children:"Date"}),e.jsx(Ne,{children:"Type"}),e.jsx(Ne,{children:"Title"}),e.jsx(Ne,{children:"Status"})]})}),e.jsx(Ke,{children:B.map(d=>e.jsxs(Oe,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Y(d),children:[e.jsx(Ce,{children:de(d.start_datetime).format("MMM D YYYY h:mm A")}),e.jsx(Ce,{children:d.activity_type}),e.jsx(Ce,{children:d.title}),e.jsx(Ce,{children:d.status})]},d.id))})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No activities."})})}),e.jsx(A,{value:"documents",children:e.jsx("section",{className:"min-h-[60vh] mx-auto max-w-5xl",children:e.jsx(os,{contactId:s.id,folders:f,documents:X,onFileUpload:(d,j,T)=>{const M=new FormData;M.append("file",d),j!==null&&M.append("folder_id",j.toString()),M.append("title",T),a.post(o,M,{onSuccess:()=>{p.success("Uploaded"),a.reload({only:["documents"]})}})},onDeleteDocument:d=>a.delete(`${o}/${d}`,{onSuccess:()=>{p.success("Deleted"),a.reload({only:["documents"]})}}),onMoveDocument:(d,j)=>a.post(`${o}/${d}/move`,{folder_id:j},{onSuccess:()=>{p.success("Moved"),a.reload({only:["documents"]})}}),onRenameDocument:(d,j)=>a.post(`${o}/${d}/rename`,{title:j},{onSuccess:()=>{p.success("Renamed"),a.reload({only:["documents"]})}}),onCreateFolder:(d,j)=>a.post(`${o}/folders`,{name:d,parent_id:j},{onSuccess:()=>{p.success("Folder created"),a.reload({only:["folders"]})}}),onRenameFolder:(d,j)=>a.post(`${o}/folders/${d}/rename`,{name:j},{onSuccess:()=>{p.success("Folder renamed"),a.reload({only:["folders"]})}}),onMoveFolder:(d,j)=>a.post(`${o}/folders/${d}/move`,{parent_id:j},{onSuccess:()=>{p.success("Folder moved"),a.reload({only:["folders"]})}}),onDeleteFolder:d=>a.delete(`${o}/folders/${d}`,{onSuccess:()=>{p.success("Folder deleted"),a.reload({only:["folders","documents"]})}})})})}),e.jsx(A,{value:"notes",children:e.jsxs("section",{className:"min-h-[60vh] mx-auto max-w-5xl space-y-4",children:[x.length?x.map(d=>e.jsxs(P,{children:[e.jsxs(oe,{className:"flex items-start justify-between py-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-medium",children:d.subject}),e.jsx("span",{className:"text-xs text-muted-foreground",children:de(d.created_at).fromNow()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{size:"icon",variant:"ghost",onClick:()=>k(d),children:e.jsx(ds,{className:"h-4 w-4"})}),e.jsx(r,{size:"icon",variant:"ghost",onClick:()=>se(d.id),children:e.jsx(ye,{className:"h-4 w-4 text-red-600"})})]})]}),v===d.id?e.jsxs(W,{className:"space-y-2",children:[e.jsx(Me,{value:N,onChange:j=>C(j.target.value),rows:4}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(r,{size:"sm",onClick:O,disabled:!N.trim(),children:"Save"}),e.jsx(r,{size:"sm",variant:"outline",onClick:()=>{w(null),C("")},children:"Cancel"})]})]}):e.jsx(W,{className:"text-sm whitespace-pre-wrap",children:d.details})]},d.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No notes yet."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{value:_,onChange:d=>I(d.target.value),placeholder:"Quick note…"}),e.jsx(r,{onClick:i,disabled:!_.trim(),children:"Add"})]})]})}),$&&e.jsx(A,{value:"client",children:e.jsx("section",{className:"min-h-[60vh]",children:e.jsx(rs,{...$})})}),F&&e.jsx(A,{value:"agent",children:e.jsx("section",{className:"min-h-[60vh]",children:e.jsx(cs,{...F})})})]}),e.jsx("div",{className:"max-w-5xl mx-auto mt-4",children:e.jsxs(r,{variant:"secondary",onClick:()=>a.visit("/admin/contacts"),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"})," Back to list"]})}),e.jsx(E,{open:!!R,onOpenChange:()=>Y(null),children:e.jsx(z,{className:"max-w-2xl",children:R&&e.jsx(He,{event:R})})})]})}export{Es as default};
